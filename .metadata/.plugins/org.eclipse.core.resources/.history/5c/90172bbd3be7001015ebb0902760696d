package com.yourorg.telemedicine.service;


import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.Random;

@Service
public class VitalSimulatorService {

    private final VitalRepository repo;
    private final AlertService alertService;
    private final Random random = new Random();

    public VitalSimulatorService(VitalRepository repo, AlertService alertService) {
        this.repo = repo;
        this.alertService = alertService;
    }

    public VitalData generateVitals(Long patientId) {
        VitalData v = new VitalData();
        v.setPatientId(patientId);
        v.setHeartRate(60 + random.nextInt(60));
        v.setSpo2(85 + random.nextInt(15));
        v.setSystolicBP(100 + random.nextInt(40));
        v.setDiastolicBP(60 + random.nextInt(30));
        v.setRecordedAt(LocalDateTime.now());

        repo.save(v);
        alertService.checkAndAlert(v);
        return v;
    }
}

