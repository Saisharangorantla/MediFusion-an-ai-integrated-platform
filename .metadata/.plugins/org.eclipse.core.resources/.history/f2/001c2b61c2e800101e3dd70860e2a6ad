package com.yourorg.telemedicine.ai.util;

import java.util.List;
import java.util.stream.Collectors;

import org.springframework.stereotype.Component;

import com.yourorg.telemedicine.ai.entity.ChatMessage;
import com.yourorg.telemedicine.ai.entity.VitalReading;



@Component
public class PromptBuilder {

    public String buildPrompt(
            VitalReading vitals,
            List<ChatMessage> history,
            String userMessage) {

        String historyText = history.stream()
                .map(m -> m.getRole() + ": " + m.getMessage())
                .collect(Collectors.joining("\n"));

        String vitalsText;

        if (vitals == null) {
            vitalsText = "No recent vital readings available.";
        } else {
            vitalsText = """
            Heart Rate: %d
            SpO2: %d
            Blood Pressure: %d/%d
            """.formatted(
                vitals.getHeartRate(),
                vitals.getSpo2(),
                vitals.getSystolicBP(),
                vitals.getDiastolicBP()
            );
        }

        return """
        You are a medical AI assistant for MediFusion.
        Give safe, simple advice. Do not diagnose.

        Patient Vitals:
        %s

        Conversation History:
        %s

        User Question:
        %s
        """.formatted(
            vitalsText,
            historyText,
            userMessage
        );
    }
}
