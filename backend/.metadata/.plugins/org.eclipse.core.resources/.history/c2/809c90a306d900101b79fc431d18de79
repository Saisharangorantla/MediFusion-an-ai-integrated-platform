package com.yourorg.telemedicine.ai.client;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.core.publisher.Mono;
import com.fasterxml.jackson.databind.JsonNode;
import org.springframework.web.reactive.function.client.WebClient;


import lombok.RequiredArgsConstructor;

@Component
@RequiredArgsConstructor
public class OpenAIClient {


private final WebClient webClient;


public Mono<String> chat(String prompt)
{
	return webClient.post()
					.bodyValue("""
							{
								"model": "gpt-4.1",
								"messages": [
							{"role": "user", "content": "%s"}
							]
							}
							""".formatted(prompt))
					.retrieve()
					.bodyToMono(JsonNode.class)
					.map(json -> json.get("choices")
							.get(0)
							.get("message")
							.get("content")
							.asText());
}
}